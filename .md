# Arquitetura de Dados 

```mermaid
flowchart TB
    %% Camada de Fontes de Dados
    subgraph sources ["FONTES DE DADOS"]
        direction TB
        bc_api[API Banco Central<br/>IPCA e Dados Econômicos]
        weather_api[API Meteorológica<br/>Dados Climáticos]
        olist_data[Dataset E-commerce<br/>Transações Olist]
        sales_stream[Stream de Vendas<br/>Dados em Tempo Real]
    end

    %% Framework de Segurança
    subgraph security ["FRAMEWORK DE SEGURANÇA"]
        direction TB
        vault[Enterprise Vault<br/>Gerenciamento de Credenciais]
        audit[Engine de Auditoria<br/>Logs de Conformidade]
        pii[Proteção PII<br/>Mascaramento de Dados]
        conn_pool[Pool de Conexões<br/>Comunicações Seguras]
    end

    %% Camada de Orquestração
    subgraph orchestration ["ORQUESTRAÇÃO - APACHE AIRFLOW"]
        direction TB
        
        subgraph ingestion ["Ingestão de Dados"]
            dag_01[dag_secure_ingestion]
            dag_02[dag_olist_consolidation]
            dag_03[dag_basic_validation]
        end
        
        subgraph transformation ["Transformação de Dados"]
            dag_04[dag_pii_masking]
            dag_05[dag_spark_processing]
            dag_06[dag_quality_validation]
        end
        
        subgraph storage_ops ["Operações de Armazenamento"]
            dag_07[dag_bronze_layer]
            dag_08[dag_silver_layer]
            dag_09[dag_lifecycle_mgmt]
        end
        
        subgraph analytics ["Pipeline Analytics"]
            dag_10[dag_minio_to_postgresql]
            dag_11[dag_star_schema_load]
        end
    end

    %% Arquitetura de Armazenamento
    subgraph storage ["ARQUITETURA DE ARMAZENAMENTO"]
        direction TB
        
        subgraph object_storage ["Object Storage - MinIO"]
            bronze[CAMADA BRONZE<br/>Dados Brutos - Retenção 7 anos]
            silver[CAMADA SILVER<br/>Dados Limpos - Retenção 5 anos]
            gold[CAMADA GOLD<br/>Dados Analytics - Retenção 3 anos]
            cold[ARMAZENAMENTO FRIO<br/>Arquivo de Longo Prazo]
        end
        
        subgraph warehouse ["Data Warehouse"]
            postgres[PostgreSQL Enterprise<br/>Cluster Alta Disponibilidade]
            star_schema[Star Schema<br/>Modelo Dimensional]
            data_marts[Data Marts de Negócio<br/>Views Analíticas]
        end
    end

    %% Camada de Governança
    subgraph governance ["GOVERNANÇA E QUALIDADE"]
        direction TB
        great_expectations[Great Expectations<br/>Framework de Qualidade]
        monitoring[Monitoramento de Pipeline<br/>Observabilidade]
        logging[Logs Centralizados<br/>Trilha de Auditoria]
        compliance[Conformidade Regulatória<br/>Linhagem de Dados]
    end

    %% Fluxo Principal de Dados
    bc_api --> dag_01
    weather_api --> dag_01
    sales_stream --> dag_01
    olist_data --> dag_02
    
    dag_01 --> dag_03
    dag_02 --> dag_03
    dag_03 --> dag_07
    dag_07 --> bronze
    
    bronze --> dag_04
    dag_04 --> dag_06
    dag_06 --> dag_05
    dag_05 --> dag_08
    dag_08 --> silver
    
    silver --> gold
    gold --> dag_10
    dag_10 --> data_marts
    data_marts --> dag_11
    dag_11 --> star_schema
    
    %% Gerenciamento de Ciclo de Vida
    dag_09 --> bronze
    dag_09 --> silver
    dag_09 --> cold
    
    %% Integração de Segurança
    vault -.->|credenciais| dag_01
    vault -.->|credenciais| dag_07
    vault -.->|credenciais| dag_08
    vault -.->|credenciais| dag_10
    vault -.->|credenciais| dag_11
    
    pii --> dag_04
    conn_pool -.->|seguro| dag_07
    conn_pool -.->|seguro| dag_08
    conn_pool -.->|seguro| dag_10
    
    %% Auditoria e Conformidade
    dag_01 --> audit
    dag_04 --> audit
    dag_05 --> audit
    dag_10 --> audit
    vault --> audit
    audit --> logging
    audit --> compliance
    
    %% Garantia de Qualidade
    great_expectations --> dag_06
    great_expectations -.->|validação| silver
    monitoring --> logging

    %% Estilização
    classDef sourceStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef securityStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef orchestrationStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef storageStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef governanceStyle fill:#ffebee,stroke:#d32f2f,stroke-width:2px

    class bc_api,weather_api,olist_data,sales_stream sourceStyle
    class vault,audit,pii,conn_pool securityStyle
    class dag_01,dag_02,dag_03,dag_04,dag_05,dag_06,dag_07,dag_08,dag_09,dag_10,dag_11 orchestrationStyle
    class bronze,silver,gold,cold,postgres,star_schema,data_marts storageStyle
    class great_expectations,monitoring,logging,compliance governanceStyle
