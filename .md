```mermaid
%% Arquitetura da Plataforma de Dados Segura e Governada

graph TD
    %% Fontes de Dados
    subgraph F1["Fontes de Dados"]
        A1[API Banco Central (IPCA)]
        A2[API OpenWeatherMap]
        A3[Datasets Públicos (Olist)]
        A4[Simulador de Stream de Vendas]
    end

    %% Ingestão e Orquestração
    subgraph F2["Ingestão e Orquestração - Apache Airflow"]
        B1[Airflow Webserver]
        B2[Airflow Scheduler & Workers]
        B3[Airflow Metadata DB (PostgreSQL)]

        subgraph DAGs
            D1[d_01_coleta_segura.py]
            D2[d_02_validacao_basica.py]
            D3[d_03_mascaramento_dados.py]
            D4[d_04_spark_processamento.py]
            D5[d_05_validacao_GE.py]
            D6[d_06_upload_bronze.py]
            D7[d_07_upload_silver.py]
            D8[d_08_lifecycle_manager.py]
            D9[d_09_datalake_para_pg.py]
            D10[d_10_star_schema_loader.py]
        end

        subgraph Segurança e Plugins
            S1[Vault / AirflowSecurityManager]
            S2[AuditLogger]
            S3[DataProtection PII]
            S4[SecureConnectionPool]
            S5[Exceções Customizadas]
        end
    end

    %% Data Lake
    subgraph F3["Data Lake - MinIO"]
        M1[MinIO Server]
        M2[Bronze Layer]
        M3[Silver Layer]
        M4[Analytics Layer]
        M5[Cold Storage]
    end

    %% Processamento
    subgraph F4["Processamento - Apache Spark"]
        SP1[Apache Spark Cluster]
    end

    %% Data Mart
    subgraph F5["Data Warehouse - PostgreSQL"]
        PG1[PostgreSQL Server]
        PG2[dim_cliente]
        PG3[dim_produto]
        PG4[fato_vendas]
        PG5[dados_olist]
    end

    %% Governança e Qualidade
    subgraph F6["Governança & Qualidade de Dados"]
        G1[Great Expectations]
        G2[Logs de Auditoria]
    end

    %% Conexões de Fluxo
    A1 --> D1
    A2 --> D1
    A3 --> D3
    A4 --> D4
    A4 --> D9

    B1 --> B2
    B2 --> B3
    B2 --> D1
    B2 --> D2
    B2 --> D3
    B2 --> D4
    B2 --> D5
    B2 --> D6
    B2 --> D7
    B2 --> D8
    B2 --> D9
    B2 --> D10

    %% Armazenamento no Data Lake
    D1 --> M2
    D2 --> M2
    D3 --> M3
    D6 --> M2
    D7 --> M3
    D4 --> M4
    M2 --> M3
    M3 --> M4
    M2 --> M5
    D8 --> M5

    %% Pipeline para PostgreSQL
    M3 --> D9
    M4 --> D9
    D9 --> PG5
    PG5 --> D10
    D10 --> PG1
    D10 --> PG2
    D10 --> PG3
    D10 --> PG4

    %% Segurança e Governança
    D1 --> S1
    D3 --> S1
    D4 --> S1
    D6 --> S1
    D7 --> S1
    D8 --> S1
    D9 --> S1
    D10 --> S1

    S1 --> S2
    S1 --> M1
    S1 --> PG1
    S4 --> S1
    S4 --> PG1
    S4 --> M1

    D1 --> S2
    D3 --> S2
    D4 --> S2
    D5 --> S2
    D6 --> S2
    D7 --> S2
    D8 --> S2
    D9 --> S2
    D10 --> S2
    D3 --> S3
    S3 --> S2

    D5 --> G1
    G1 --> S2
    D5 --> S5

    S2 --> G2

    %% Estilos Profissionais
    classDef default fill:#f9f9f9,stroke:#ccc,stroke-width:1px;
    classDef groupTitle fill:#ECEFF1,stroke:#607D8B,stroke-width:2px,font-weight:bold;
    classDef airflow fill:#E3F2FD,stroke:#2196F3;
    classDef dag fill:#FFF3E0,stroke:#FB8C00;
    classDef security fill:#FCE4EC,stroke:#D81B60;
    classDef lake fill:#E8F5E9,stroke:#388E3C;
    classDef spark fill:#FFFDE7,stroke:#FBC02D;
    classDef pg fill:#E1F5FE,stroke:#0288D1;
    classDef quality fill:#F3E5F5,stroke:#8E24AA;

    class F1,F2,F3,F4,F5,F6 groupTitle;
    class B1,B2,B3 airflow;
    class D1,D2,D3,D4,D5,D6,D7,D8,D9,D10 dag;
    class S1,S2,S3,S4,S5 security;
    class M1,M2,M3,M4,M5 lake;
    class SP1 spark;
    class PG1,PG2,PG3,PG4,PG5 pg;
    class G1,G2 quality;
```
