```mermaid
graph TD
    %% Fontes de Dados
    subgraph F1["Fontes de Dados"]
        A1[API Banco Central]
        A2[API OpenWeatherMap]
        A3[Datasets Publicos (Olist)]
        A4[Stream de Vendas (Simulada)]
    end

    %% Ingestao e Orquestracao
    subgraph F2["Ingestao e Orquestracao - Airflow"]
        B1[Airflow Webserver]
        B2[Airflow Scheduler e Workers]
        B3[Airflow Metadata DB (PostgreSQL)]

        subgraph DAGs
            D1[d_01_coleta_segura]
            D2[d_02_validacao_basica]
            D3[d_03_mascaramento_dados]
            D4[d_04_spark_processamento]
            D5[d_05_validacao_GE]
            D6[d_06_upload_bronze]
            D7[d_07_upload_silver]
            D8[d_08_lifecycle_manager]
            D9[d_09_datalake_para_pg]
            D10[d_10_star_schema_loader]
        end

        subgraph Segurança
            S1[Vault / Auth Manager]
            S2[Audit Logger]
            S3[Protecao de Dados PII]
            S4[Secure Connection Pool]
            S5[Excecoes Customizadas]
        end
    end

    %% Data Lake
    subgraph F3["Data Lake - MinIO"]
        M1[MinIO Server]
        M2[Bronze Layer]
        M3[Silver Layer]
        M4[Analytics Layer]
        M5[Cold Storage]
    end

    %% Processamento
    subgraph F4["Processamento - Spark"]
        SP1[Apache Spark Cluster]
    end

    %% Data Warehouse
    subgraph F5["Data Warehouse - PostgreSQL"]
        PG1[PostgreSQL Server]
        PG2[dim_cliente]
        PG3[dim_produto]
        PG4[fato_vendas]
        PG5[dados_olist]
    end

    %% Governanca
    subgraph F6["Governanca e Qualidade"]
        G1[Great Expectations]
        G2[Logs de Auditoria]
    end

    %% Conexoes principais
    A1 --> D1
    A2 --> D1
    A3 --> D3
    A4 --> D4
    A4 --> D9

    B1 --> B2
    B2 --> B3
    B2 --> D1
    B2 --> D2
    B2 --> D3
    B2 --> D4
    B2 --> D5
    B2 --> D6
    B2 --> D7
    B2 --> D8
    B2 --> D9
    B2 --> D10

    %% Fluxo de camadas
    D1 --> M2
    D2 --> M2
    D3 --> M3
    D6 --> M2
    D7 --> M3
    D4 --> M4
    M2 --> M3
    M3 --> M4
    M2 --> M5
    D8 --> M5

    %% Para o DW
    M3 --> D9
    M4 --> D9
    D9 --> PG5
    PG5 --> D10
    D10 --> PG1
    D10 --> PG2
    D10 --> PG3
    D10 --> PG4

    %% Segurança e Governanca
    D1 --> S1
    D3 --> S1
    D4 --> S1
    D6 --> S1
    D7 --> S1
    D8 --> S1
    D9 --> S1
    D10 --> S1

    S1 --> S2
    S1 --> M1
    S1 --> PG1
    S4 --> S1
    S4 --> PG1
    S4 --> M1

    D1 --> S2
    D3 --> S2
    D4 --> S2
    D5 --> S2
    D6 --> S2
    D7 --> S2
    D8 --> S2
    D9 --> S2
    D10 --> S2
    D3 --> S3
    S3 --> S2

    D5 --> G1
    G1 --> S2
    D5 --> S5

    S2 --> G2
```
