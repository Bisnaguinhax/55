# Arquitetura de Dados 

```mermaid
graph TB
    %% ===========================================
    %% ENTERPRISE DATA ARCHITECTURE
    %% Banking-Grade Secure Data Pipeline
    %% ===========================================
    
    subgraph "DATA SOURCES LAYER"
        direction TB
        API_BC["Central Bank API<br/>IPCA & Economic Indicators"]
        API_WEATHER["Weather Intelligence API<br/>Climate Data Integration"]
        DS_OLIST["E-commerce Dataset<br/>Olist Transactional Data"]
        STREAM_SALES["Real-time Sales Stream<br/>Live Transaction Feed"]
    end

    subgraph "ENTERPRISE SECURITY FRAMEWORK"
        direction TB
        SEC_VAULT["Enterprise Vault Manager<br/>Credential & Key Management"]
        SEC_AUDIT["Compliance Audit Engine<br/>SOX/GDPR Trail Logging"]
        SEC_PII["PII Protection Service<br/>Dynamic Data Masking"]
        SEC_CONN["Secure Connection Pool<br/>TLS/mTLS Management"]
    end

    subgraph "ORCHESTRATION LAYER - APACHE AIRFLOW"
        direction TB
        
        subgraph "Data Ingestion Pipeline"
            DAG_01["dag_secure_ingestion<br/>Multi-source Data Collection"]
            DAG_02["dag_olist_consolidation<br/>Dataset Harmonization"]
            DAG_03["dag_basic_validation<br/>Schema & Format Validation"]
        end
        
        subgraph "Data Transformation Pipeline"
            DAG_04["dag_pii_masking<br/>Privacy-Safe Transformation"]
            DAG_05["dag_spark_processing<br/>Distributed Data Processing"]
            DAG_06["dag_quality_validation<br/>Great Expectations Suite"]
        end
        
        subgraph "Data Storage Pipeline"
            DAG_07["dag_bronze_layer<br/>Raw Data Persistence"]
            DAG_08["dag_silver_layer<br/>Clean Data Repository"]
            DAG_09["dag_lifecycle_mgmt<br/>Data Retention Policies"]
        end
        
        subgraph "Analytics Pipeline"
            DAG_10["dag_minio_to_postgresql<br/>Analytics Data Movement"]
            DAG_11["dag_star_schema_load<br/>Dimensional Model Load"]
        end
    end

    subgraph "ENTERPRISE STORAGE ARCHITECTURE"
        direction TB
        
        subgraph "Object Storage - MinIO S3 Compatible"
            BRONZE_LAYER["BRONZE LAYER<br/>Raw Ingested Data<br/>Retention: 7 years"]
            SILVER_LAYER["SILVER LAYER<br/>Cleaned & Validated Data<br/>Retention: 5 years"]
            GOLD_LAYER["GOLD LAYER<br/>Analytics-Ready Data<br/>Retention: 3 years"]
            ARCHIVE_LAYER["COLD STORAGE<br/>Compressed Archives<br/>Long-term Retention"]
        end
        
        subgraph "Enterprise Data Warehouse"
            PG_WAREHOUSE["PostgreSQL Enterprise DW<br/>High-Availability Cluster"]
            DIMENSIONAL_MODEL["Star Schema Architecture<br/>Fact & Dimension Tables"]
            OLIST_MARTS["Business Data Marts<br/>Optimized Analytics Views"]
        end
    end

    subgraph "GOVERNANCE & QUALITY ASSURANCE"
        direction TB
        GE_SUITE["Great Expectations<br/>Data Quality Framework"]
        AUDIT_LOGS["Centralized Logging<br/>Elasticsearch/Splunk"]
        MONITORING["Pipeline Monitoring<br/>Alerting & Observability"]
        COMPLIANCE["Regulatory Compliance<br/>Data Lineage Tracking"]
    end

    %% ===========================================
    %% PRIMARY DATA FLOW CONNECTIONS
    %% ===========================================
    
    %% Source to Ingestion
    API_BC --> DAG_01
    API_WEATHER --> DAG_01
    STREAM_SALES --> DAG_01
    DS_OLIST --> DAG_02

    %% Ingestion Pipeline Flow
    DAG_01 --> DAG_03
    DAG_02 --> DAG_03
    DAG_03 --> DAG_07
    DAG_07 --> BRONZE_LAYER

    %% Transformation Pipeline Flow
    BRONZE_LAYER --> DAG_04
    DAG_04 --> DAG_06
    DAG_06 --> DAG_05
    DAG_05 --> DAG_08
    DAG_08 --> SILVER_LAYER

    %% Analytics Pipeline Flow
    SILVER_LAYER --> GOLD_LAYER
    GOLD_LAYER --> DAG_10
    DAG_10 --> OLIST_MARTS
    OLIST_MARTS --> DAG_11
    DAG_11 --> DIMENSIONAL_MODEL

    %% Lifecycle Management
    DAG_09 --> BRONZE_LAYER
    DAG_09 --> SILVER_LAYER
    DAG_09 --> ARCHIVE_LAYER
    BRONZE_LAYER -.->|Archive Policy| ARCHIVE_LAYER

    %% ===========================================
    %% SECURITY INTEGRATION FLOWS
    %% ===========================================
    
    %% Credential Management
    SEC_VAULT -.->|API Keys| DAG_01
    SEC_VAULT -.->|Storage Credentials| DAG_07
    SEC_VAULT -.->|Storage Credentials| DAG_08
    SEC_VAULT -.->|Database Credentials| DAG_10
    SEC_VAULT -.->|Database Credentials| DAG_11
    SEC_VAULT -.->|Encryption Keys| SEC_PII

    %% PII Protection Integration
    SEC_PII --> DAG_04
    SEC_PII -.->|Masking Rules| SILVER_LAYER

    %% Secure Connections
    SEC_CONN -.->|TLS Connections| DAG_07
    SEC_CONN -.->|TLS Connections| DAG_08
    SEC_CONN -.->|TLS Connections| DAG_10
    SEC_CONN -.->|TLS Connections| DAG_11

    %% ===========================================
    %% AUDIT & COMPLIANCE FLOWS
    %% ===========================================
    
    %% Comprehensive Audit Trail
    DAG_01 --> SEC_AUDIT
    DAG_02 --> SEC_AUDIT
    DAG_04 --> SEC_AUDIT
    DAG_05 --> SEC_AUDIT
    DAG_06 --> SEC_AUDIT
    DAG_10 --> SEC_AUDIT
    DAG_11 --> SEC_AUDIT
    SEC_VAULT --> SEC_AUDIT
    SEC_PII --> SEC_AUDIT

    %% Audit Outputs
    SEC_AUDIT --> AUDIT_LOGS
    SEC_AUDIT --> COMPLIANCE

    %% ===========================================
    %% QUALITY & MONITORING FLOWS
    %% ===========================================
    
    %% Quality Validation Integration
    GE_SUITE --> DAG_06
    GE_SUITE -.->|Validation Rules| SILVER_LAYER
    DAG_06 -.->|Quality Gate| GOLD_LAYER

    %% Monitoring Integration
    MONITORING -.->|Observability| DAG_01
    MONITORING -.->|Observability| DAG_05
    MONITORING -.->|Observability| DAG_10
    MONITORING --> AUDIT_LOGS

    %% ===========================================
    %% PROFESSIONAL STYLING
    %% ===========================================
    
    %% Color Palette - Enterprise Theme
    classDef sourceLayer fill:#1565C0,stroke:#0D47A1,stroke-width:3px,color:#ffffff,font-weight:bold
    classDef securityLayer fill:#7B1FA2,stroke:#4A148C,stroke-width:3px,color:#ffffff,font-weight:bold
    classDef orchestrationLayer fill:#2E7D32,stroke:#1B5E20,stroke-width:3px,color:#ffffff,font-weight:bold
    classDef storageLayer fill:#E65100,stroke:#BF360C,stroke-width:3px,color:#ffffff,font-weight:bold
    classDef governanceLayer fill:#D32F2F,stroke:#B71C1C,stroke-width:3px,color:#ffffff,font-weight:bold
    classDef auditLayer fill:#E91E63,stroke:#C2185B,stroke-width:3px,color:#ffffff,font-weight:bold

    %% Apply Styling
    class API_BC,API_WEATHER,DS_OLIST,STREAM_SALES sourceLayer
    class SEC_VAULT,SEC_AUDIT,SEC_PII,SEC_CONN securityLayer
    class DAG_01,DAG_02,DAG_03,DAG_04,DAG_05,DAG_06,DAG_07,DAG_08,DAG_09,DAG_10,DAG_11 orchestrationLayer
    class BRONZE_LAYER,SILVER_LAYER,GOLD_LAYER,ARCHIVE_LAYER,PG_WAREHOUSE,DIMENSIONAL_MODEL,OLIST_MARTS storageLayer
    class GE_SUITE,MONITORING,COMPLIANCE governanceLayer
    class AUDIT_LOGS auditLayer
